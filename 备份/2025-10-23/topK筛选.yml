app:
  description: ''
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: 10.23 topkç­›é€‰ å¼•å…¥ä¸Šä¸‹æ–‡
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/deepseek:0.0.6@dd589dc093c8084925858034ab5ec1fdf0d33819f43226c2f8c4a749a9acbbb2
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: code
      id: 1759462105654-source-1759462328767-target
      selected: false
      source: '1759462105654'
      sourceHandle: source
      target: '1759462328767'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: iteration
      id: 1759462328767-source-1759467601110-target
      selected: false
      source: '1759462328767'
      sourceHandle: source
      target: '1759467601110'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1759467601110'
        sourceType: iteration-start
        targetType: llm
      id: 1759467601110start-source-1759467629444-target
      selected: false
      source: 1759467601110start
      sourceHandle: source
      target: '1759467629444'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1759467601110'
        sourceType: llm
        targetType: code
      id: 1759467629444-source-1759467659348-target
      selected: false
      source: '1759467629444'
      sourceHandle: source
      target: '1759467659348'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: iteration
        targetType: iteration
      id: 1759467601110-source-1761146628628-target
      source: '1759467601110'
      sourceHandle: source
      target: '1761146628628'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1761146628628'
        sourceType: iteration-start
        targetType: code
      id: 1761146628628start-source-1761146637925-target
      source: 1761146628628start
      sourceHandle: source
      target: '1761146637925'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1761146628628'
        sourceType: code
        targetType: llm
      id: 1761146637925-source-1761146640444-target
      source: '1761146637925'
      sourceHandle: source
      target: '1761146640444'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1761146628628'
        sourceType: llm
        targetType: code
      id: 1761146640444-source-1761146644616-target
      source: '1761146640444'
      sourceHandle: source
      target: '1761146644616'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: iteration
        targetType: code
      id: 1761146628628-source-1761146651735-target
      source: '1761146628628'
      sourceHandle: source
      target: '1761146651735'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: answer
      id: 1761146651735-source-1761146711281-target
      source: '1761146651735'
      sourceHandle: source
      target: '1761146711281'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: temp
          max_length: 10000000
          options:
          - CELEX_42006X1227(06)_EN_TXT
          - R048r12e
          required: true
          type: select
          variable: base_dir
      height: 89
      id: '1759462105654'
      position:
        x: 30
        y: 306.5
      positionAbsolute:
        x: 30
        y: 306.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nimport os\n\ndef estimate_tokens(text: str) -> int:\n\
          \    \"\"\"ä¼°ç®—æ–‡æœ¬çš„tokenæ•°é‡\"\"\"\n    # å¦‚æœtiktokenä¸å¯ç”¨ï¼Œä½¿ç”¨ç²—ç•¥ä¼°ç®—ï¼š1ä¸ªtokençº¦4ä¸ªå­—ç¬¦\n\
          \    return len(text) // 4\n\ndef main(base_dir: str) -> dict:    \n   \
          \ file_path = f\"/tmp/mydata/{base_dir}/comparison_results.json\"\n\n  \
          \  with open(file_path, 'r', encoding='utf-8') as f:\n        data = json.load(f)\n\
          \    \n    # æ¯ä¸ªåˆ†ç»„çš„é¡¹ç›®æ•°é‡\n    items_per_chunk = 15\n    \n    chunks = []\n\
          \    for i in range(0, len(data), items_per_chunk):\n        chunk_data\
          \ = data[i:i + items_per_chunk]\n        chunk_json = json.dumps(chunk_data,\
          \ ensure_ascii=False)\n        chunks.append(chunk_json)\n    \n    # è¾“å‡ºåˆ†å—ä¿¡æ¯ç”¨äºè°ƒè¯•\n\
          \    print(f\"æ€»å…±åˆ†ä¸º {len(chunks)} ä¸ªåˆ†å—\")\n    for i, chunk in enumerate(chunks):\n\
          \        tokens = estimate_tokens(chunk)\n        chunk_data = json.loads(chunk)\n\
          \        start_id = chunk_data[0].get('chapter_id', '') if chunk_data else\
          \ ''\n        end_id = chunk_data[-1].get('chapter_id', '') if chunk_data\
          \ else ''\n        print(f\"åˆ†å— {i+1}: {len(chunk_data)} ä¸ªé¡¹ç›®, ~{tokens} tokens,\
          \ ä» {start_id} åˆ° {end_id}\")\n    \n    return {\n        \"chunks\": chunks,\n\
          \        \"total_chunks\": len(chunks)\n    }"
        code_language: python3
        desc: ''
        outputs:
          chunks:
            children: null
            type: array[string]
          total_chunks:
            children: null
            type: number
        selected: false
        title: ä»£ç æ‰§è¡Œ
        type: code
        variables:
        - value_selector:
          - '1759462105654'
          - base_dir
          value_type: string
          variable: base_dir
      height: 53
      id: '1759462328767'
      position:
        x: 334
        y: 306.5
      positionAbsolute:
        x: 334
        y: 306.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        error_handle_mode: continue-on-error
        height: 213
        is_parallel: true
        iterator_input_type: array[string]
        iterator_selector:
        - '1759462328767'
        - chunks
        output_selector:
        - '1759467659348'
        - result
        output_type: array[string]
        parallel_nums: 10
        selected: false
        start_node_id: 1759467601110start
        title: è¿­ä»£
        type: iteration
        width: 1072
      height: 213
      id: '1759467601110'
      position:
        x: 612.6514285714286
        y: 306.5
      positionAbsolute:
        x: 612.6514285714286
        y: 306.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 1072
      zIndex: 1
    - data:
        desc: ''
        isInIteration: true
        selected: false
        title: ''
        type: iteration-start
      draggable: false
      height: 48
      id: 1759467601110start
      parentId: '1759467601110'
      position:
        x: 60
        y: 80.5
      positionAbsolute:
        x: 672.6514285714286
        y: 387
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-iteration-start
      width: 44
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1759467601110'
        model:
          completion_params: {}
          mode: chat
          name: deepseek-reasoner
          provider: langgenius/deepseek/deepseek
        prompt_template:
        - id: b13d17ca-b83f-43f7-9e7e-b8794867394f
          role: system
          text: "# è§’è‰²\n\nä½ æ˜¯ä¸€ä¸ªæ±½è½¦æ£€æµ‹é¢†åŸŸçš„æ³•è§„/æ ‡å‡†æ¡æ¬¾åŒ¹é…ä¸“å®¶ï¼Œä»»åŠ¡æ˜¯åœ¨`json`æ•°æ®ä¸­ï¼Œä¸ºæ¯ä¸ªç« èŠ‚æ‰¾åˆ°æœ€åˆé€‚çš„å€™é€‰ç« èŠ‚ï¼Œç¡®ä¿å®ƒä»¬è°ˆè®ºåŒä¸€ä¸»é¢˜æˆ–æ¶‰åŠé«˜åº¦ç›¸ä¼¼çš„å†…å®¹ï¼Œä¾¿äºåç»­è¿›è¡Œå·®å¼‚åŒ–åˆ†æã€‚\n\
            \n# è¾“å‡ºæ ¼å¼\n\nè¾“å‡ºå¿…é¡»æ˜¯çº¯å‡€ã€å®Œæ•´çš„`json`å¯¹è±¡ï¼Œç¡®ä¿å¯ä»¥è¢«`json.loads()`ç›´æ¥è§£æï¼Œç»“æ„å¦‚ä¸‹ï¼š\n\n```\n\
            [\n  \"file\": \"string\",\n  \"section\": \"string\",\n  \"chapter_id\"\
            : \"string\",\n  \"choices\":[] // åˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰åŒ¹é…çš„å€™é€‰ç« èŠ‚è·¯å¾„ï¼Œå¦‚[\"regulation\",\"\
            MAIN\",\"3.1\"]\n]\n```\n\n# æŒ‡å¯¼åŸåˆ™\n\n- ä¸è¦ä»…ä¾èµ–åˆ†æ•°ï¼šåˆ†æ•°æ˜¯é€šè¿‡`scope`ã€`parameters`ã€`topic_keywords`ã€`context_keywords`ã€å’Œ`parameters`å­—æ®µåˆ†åˆ«è¿›è¡Œå‘é‡åŒ–å’Œå¬å›æ“ä½œï¼Œç„¶ååŠ æƒå¾—åˆ°ï¼Œå¯èƒ½æ— æ³•æ•æ‰è¯­ä¹‰ç»†èŠ‚ï¼Œè¯·ç¡®ä¿å§‹ç»ˆä»¥å†…å®¹ç†è§£ä¸ºä¸»ã€‚\n\
            - åŸå§‹æ–‡æœ¬åˆ†æï¼šè¯·åˆ©ç”¨`raw_text`å’Œ`chapter_title`å­—æ®µä»¥ä¾¿æ›´å¥½åœ°ç†è§£å†…å®¹ã€‚\n- è¡¨å¤´ç›¸ä¼¼æˆ–å‚æ•°ç›¸ä¼¼ï¼Œé€šå¸¸æ˜¯å¼ºåŒ¹é…ä¿¡å·\n\
            - èŒƒå›´ä¼˜å…ˆï¼šscopeå­—æ®µæ˜¯é«˜å±‚ä¸»é¢˜ï¼Œåº”é¦–å…ˆè€ƒè™‘æ˜¯å¦ä¸€è‡´ã€‚\n- å±‚çº§ä¸€è‡´æ€§ï¼šå³å±‚çº§ä¸å¯èƒ½ç›¸å·®å·¨å¤§ï¼Œé€‰æ‹©æ—¶è¦æ ¼å¤–æ³¨æ„ï¼ˆæ¯”å¦‚å½“å‰ç« èŠ‚æ˜¯æœ€å¤–å±‚3ï¼Œä¸å¤ªå¯èƒ½åŒ¹é…å€™é€‰ç« èŠ‚ä¸­çš„8.2.1.10.2ç­‰ï¼Œåä¹‹äº¦ç„¶ï¼‰ã€‚\n\
            - ç©ºé—´ä¸€è‡´æ€§ï¼šç›¸è¿‘çš„å½“å‰ç« èŠ‚ï¼ˆæ¯”å¦‚7.2.1ï¼Œ7.2.2ï¼Œ7.2.3ï¼Œä½†ä¸åŒ…æ‹¬2å’Œ3è¿™ç§å¤–å±‚ç« èŠ‚è·¨è¶Šçš„æƒ…å†µï¼‰ï¼Œé€‰å‡ºæ¥çš„æœ€åŒ¹é…å€™é€‰ç« èŠ‚åœ¨ç©ºé—´ä¸Šä¸åº”ç›¸éš”å¤ªè¿œï¼ˆæ¯”å¦‚5.3.1.5.1ï¼Œ7.3ï¼Œ12.3.1.5ç­‰ï¼‰ï¼Œé€‰æ‹©æ—¶è¦æ ¼å¤–æ³¨æ„\n\
            - å¤§èƒ†åœ°ä¸é€‰æ‹©ï¼šä¸æ˜¯æ¯ä¸ªé¡¹éƒ½å¿…é¡»è¾“å‡ºåŒ¹é…å†…å®¹ï¼Œåœ¨å……åˆ†ç†è§£è¯­ä¹‰åè®¤ä¸ºä¸åŒ¹é…çš„é¡¹åº”è¯¥å¤§èƒ†åœ°ä¸è¿›è¡Œé€‰æ‹©ã€‚"
        - id: 91c473ce-d57a-4bb7-be52-7f995238c1a7
          role: user
          text: '{{#1759467601110.item#}}'
        selected: false
        title: LLM 2
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1759467629444'
      parentId: '1759467601110'
      position:
        x: 202.45150117500214
        y: 78.96000000000004
      positionAbsolute:
        x: 815.1029297464307
        y: 385.46000000000004
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
      zIndex: 1002
    - data:
        code: "import json\nimport ast\nimport re\nfrom typing import Dict, List,\
          \ Any\n\ndef parse_input(src: str) -> List[Dict[str, Any]]:\n    \"\"\"\
          é¢„å¤„ç†å¹¶è§£æè¾“å…¥å­—ç¬¦ä¸²ä¸ºåˆ—è¡¨å­—å…¸ç»“æ„\"\"\"\n    try:\n        # 1. æŒ‰ </think> åˆ‡åˆ†å¹¶å–ååŠæ®µ\n  \
          \      src = src.rsplit('</think>', 1)[-1].strip()\n\n        # 2. å…ˆå¹²æ‰ deepseek\
          \ V3 å¯èƒ½æ’å…¥çš„â€œæé€Ÿâ€æˆ–å•ç‹¬çš„â€œæâ€\n        src = re.sub(r'æé€Ÿ\\s*', '', src)   # å»æ‰â€œæé€Ÿâ€åŠå…¶åå¯èƒ½çš„å¤šä½™ç©ºç™½\n\
          \        src = re.sub(r'(?<!\\w)æ(?!\\w)', '', src)  # å»æ‰å­¤ç«‹å‡ºç°çš„â€œæâ€\n\n  \
          \      # 3. å°è¯•å¤šç§è§£æè·¯å¾„\n        try:\n            data = json.loads(src)\n\
          \        except json.JSONDecodeError:\n            try:\n              \
          \  if src.startswith('\\ufeff'):\n                    src = src[1:]\n  \
          \              data = ast.literal_eval(src)\n            except (SyntaxError,\
          \ ValueError):\n                try:\n                    processed = src.replace('\\\
          \\\"', '\"').replace('\\\\n', '\\n')\n                    data = json.loads(processed)\n\
          \                except Exception as e:\n                    raise ValueError(f\"\
          æ— æ³•è§£æï¼š{str(e)}\")\n\n        # 4. ä¿è¯è¿”å› list\n        if isinstance(data,\
          \ dict):\n            return [data]\n        elif isinstance(data, list):\n\
          \            return data\n        else:\n            return []\n    except\
          \ Exception as e:\n        raise ValueError(f\"é¢„å¤„ç†å¤±è´¥: {str(e)}\")\n\n\n\
          def main(arg1: str) -> dict:\n    data = parse_input(arg1)\n    # data =\
          \ json.dumps(data,ensure_ascii=False)\n    json_data = [json.dumps(item,\
          \ ensure_ascii=False) for item in data]\n    \n    return {\n        \"\
          result\":json_data\n    }"
        code_language: python3
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1759467601110'
        outputs:
          result:
            children: null
            type: array[string]
        selected: false
        title: ä»£ç æ‰§è¡Œ 2
        type: code
        variables:
        - value_selector:
          - '1759467629444'
          - text
          value_type: string
          variable: arg1
      height: 53
      id: '1759467659348'
      parentId: '1759467601110'
      position:
        x: 506.3590023500042
        y: 77.95999999999998
      positionAbsolute:
        x: 1119.0104309214328
        y: 384.46
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
      zIndex: 1002
    - data:
        desc: ''
        error_handle_mode: continue-on-error
        height: 177
        is_parallel: true
        iterator_input_type: array[string]
        iterator_selector:
        - '1759467601110'
        - output
        output_selector:
        - '1761146644616'
        - result
        output_type: array[string]
        parallel_nums: 10
        selected: false
        start_node_id: 1761146628628start
        title: è¿­ä»£ 2
        type: iteration
        width: 996
      height: 177
      id: '1761146628628'
      position:
        x: 1768.6844988249977
        y: 306.5
      positionAbsolute:
        x: 1768.6844988249977
        y: 306.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 996
      zIndex: 1
    - data:
        desc: ''
        isInIteration: true
        selected: false
        title: ''
        type: iteration-start
      draggable: false
      height: 48
      id: 1761146628628start
      parentId: '1761146628628'
      position:
        x: 24
        y: 68
      positionAbsolute:
        x: 1792.6844988249977
        y: 374.5
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-iteration-start
      width: 44
      zIndex: 1002
    - data:
        code: "import json\nimport copy\nfrom typing import List, Dict, Any, Optional,\
          \ Tuple\n\ndef find_path(chapters: List[Dict[str, Any]], target_id: str)\
          \ -> Optional[List[Dict[str, Any]]]:\n    \"\"\"\n    åœ¨ä»»æ„å±‚çº§ chapters ä¸­æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œæ‰¾åˆ°\
          \ chapter_id == target_id çš„èŠ‚ç‚¹è·¯å¾„ï¼ˆåˆ—è¡¨ï¼‰ã€‚\n    è‹¥æ‰¾åˆ°åˆ™è¿”å›ä»é¡¶è‡³ç›®æ ‡èŠ‚ç‚¹çš„èŠ‚ç‚¹åˆ—è¡¨ï¼›æ‰¾ä¸åˆ°è¿”å› Noneã€‚\n\
          \    \"\"\"\n    stack = []\n\n    def dfs(nodes):\n        for node in\
          \ nodes:\n            stack.append(node)\n            if node.get(\"chapter_id\"\
          ) == target_id:\n                return True\n            children = node.get(\"\
          children\") or [] # è¿™é‡Œæƒ³è·å¾—å­©å­è¯¥æ€ä¹ˆæ”¹ï¼Ÿ\n            if dfs(children):\n      \
          \          return True\n            stack.pop()\n        return False\n\n\
          \    if dfs(chapters):\n        return stack.copy()\n    return None\n\n\
          \ndef prune_to_path(path_nodes: List[Dict[str, Any]]) -> Dict[str, Any]:\n\
          \    \"\"\"\n    æ ¹æ®è·¯å¾„èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ„é€ ä¸€æ£µåªåŒ…å«è·¯å¾„åˆ†æ”¯çš„å­æ ‘ã€‚\n    è¾“å‡ºä¸ºè·¯å¾„é¦–èŠ‚ç‚¹ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€çº§ç›®å½•ï¼Œå¦‚ '1.'ï¼‰çš„æ·±æ‹·è´ï¼Œ\n\
          \    ä¸”å…¶ children åªä¿ç•™è·¯å¾„ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå…¶ä»–åŒçº§å…¨éƒ¨è£æ‰ï¼‰ã€‚\n    \"\"\"\n    # ä»æ ¹åˆ°å¶é€å±‚æ„å»º\n \
          \   def build(i: int) -> Dict[str, Any]:\n        # æ·±æ‹·è´ä»¥é¿å…ä¿®æ”¹åŸæ•°æ®\n      \
          \  node_copy = copy.deepcopy(path_nodes[i])\n        # æœ«ç«¯èŠ‚ç‚¹ï¼šchildren æ¸…ç©º\n\
          \        if i == len(path_nodes) - 1:\n            node_copy[\"children\"\
          ] = []\n            return node_copy\n        # éæœ«ç«¯ï¼šchildren åªä¿ç•™è·¯å¾„ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n\
          \        next_child = build(i + 1)\n        node_copy[\"children\"] = [next_child]\n\
          \        return node_copy\n\n    return build(0)\n\n\ndef keep_section_with_pruned_chapters(section:\
          \ Dict[str, Any], pruned_root: Dict[str, Any]) -> Dict[str, Any]:\n    \"\
          \"\"\n    ä»…ä¿ç•™æ‰¾åˆ°ç›®æ ‡ç« èŠ‚æ‰€åœ¨çš„ sectionï¼Œå¹¶å°†å…¶ä¸­ chapters æ›¿æ¢ä¸ºä»…åŒ…å«è£å‰ªåçš„æ ¹èŠ‚ç‚¹ã€‚\n    å…¶ä»– sectionï¼ˆè‹¥æœ‰ï¼‰å°†ä¸ä¿ç•™ï¼ˆè°ƒç”¨æ–¹å†³å®šï¼‰ã€‚\n\
          \    \"\"\"\n    kept = copy.deepcopy(section)\n    kept[\"chapters\"] =\
          \ [pruned_root]\n    return kept\n\n\ndef extract_chain(data: List[Dict[str,\
          \ Any]], target_id: str) -> Tuple[List[Dict[str, Any]], bool]:\n    \"\"\
          \"\n    åœ¨æ•´ä¸ªæ•°æ®ä¸­æŸ¥æ‰¾ target_idï¼Œè‹¥æ‰¾åˆ°ï¼š\n      - ä»…ä¿ç•™å‘½ä¸­çš„é‚£ä¸ª section\n      - section.chapters\
          \ åªä¿ç•™â€œç¬¬ä¸€çº§ç›®å½• â†’ â€¦ â†’ target_idâ€è¿™æ¡é“¾\n    è¿”å› (new_data, found)\n    \"\"\"\n\
          \    new_data = []\n    found_any = False\n\n    for f in data:\n      \
          \  file_obj = copy.deepcopy(f)\n        sections = f.get(\"sections\") or\
          \ []\n\n        if sections:\n            sec = sections[0] # åªæ‰¾ç¬¬ä¸€ä¸ª\n  \
          \          chapters = sec.get(\"chapters\") or []\n            path = find_path(chapters,\
          \ target_id)\n            if path:\n                # path[0] å³è¯¥ç›®æ ‡æ‰€å±çš„â€œç¬¬ä¸€çº§ç›®å½•â€èŠ‚ç‚¹ï¼ˆå¦‚\
          \ '1.' æˆ– '5.'ï¼‰\n                pruned_root = prune_to_path(path)\n    \
          \            file_obj[\"sections\"]=[keep_section_with_pruned_chapters(sec,\
          \ pruned_root)]\n                new_data.append(file_obj)\n           \
          \     found_any = True\n                # åªä¿ç•™å‘½ä¸­çš„é‚£ä¸ª sectionï¼Œé€šå¸¸ä¸€ä¸ª target åªä¼šå‘½ä¸­ä¸€ä¸ª\
          \ section\n                break\n\n    return new_data, found_any\n\ndef\
          \ fix_format(item):\n    \"\"\"ä¿®æ­£é”™è¯¯çš„æ ¼å¼\"\"\"\n    # å¦‚æœæ˜¯é•¿åº¦ä¸º3çš„åˆ—è¡¨ï¼Œä¸”ç¬¬ä¸‰ä¸ªå…ƒç´ ç¬¦åˆæ ¼å¼è¦æ±‚ï¼Œåˆ™è¿”å›é‡æ–°å°è£…åçš„åˆ—è¡¨\n\
          \    if len(item) == 3 and isinstance(item[2], str):\n        return [item]\
          \  # å°†å…¶å°è£…åœ¨ä¸€ä¸ªæ–°çš„åˆ—è¡¨ä¸­\n    return item\n\ndef process_choices(input_data: Dict[str,\
          \ Any], right_data: List[Dict[str, Any]],left_data: List[Dict[str, Any]])\
          \ -> Dict[str, Any]:\n    \"\"\"\n    æ ¹æ® 'choices' ä¸­çš„æ¯ä¸ª chapter_id æŸ¥æ‰¾ç« èŠ‚å†…å®¹ï¼Œå¹¶å°†æ‰€æœ‰æ‰¾åˆ°çš„\
          \ context åˆå¹¶åˆ°ä¸€ä¸ªå­—æ®µä¸­\n    \"\"\"\n    context_combined = []\n\n    # å¤„ç†æ¯ä¸ª\
          \ choice\n    for choice in input_data.get(\"choices\", []):\n        fix_format(choice)\n\
          \        chapter_id = choice[2]  # è·å– chapter_idï¼ˆç¬¬ä¸‰é¡¹ï¼‰\n        pruned_data,\
          \ found = extract_chain(right_data, chapter_id)\n\n        if found:\n \
          \           context_combined.append(pruned_data[0])\n    \n    chapter_id\
          \ = input_data.get(\"chapter_id\",\"\")\n    pruned_data,found = extract_chain(left_data,chapter_id)\n\
          \n    if found:\n        input_data[\"chapter_context\"] = pruned_data\n\
          \    \n    input_data[\"choice_context\"] = context_combined\n    return\
          \ input_data\n\ndef main(base_dir:str,text:str) -> dict:\n\n    right_path\
          \ = f\"/tmp/mydata/{base_dir}/ECE.json\"\n    left_path = f\"/tmp/mydata/{base_dir}/GSO.json\"\
          \n\n    with open(right_path, \"r\", encoding=\"utf-8\") as f:\n       \
          \ right_data = json.load(f)\n\n    with open(left_path, \"r\", encoding=\"\
          utf-8\") as f:\n        left_data = json.load(f)\n\n    input_data = json.loads(text)\n\
          \n    result_data = process_choices(input_data, right_data,left_data)\n\
          \    res = json.dumps(result_data,ensure_ascii=False,)\n\n    return {\n\
          \        \"result\":res\n    }"
        code_language: python3
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1761146628628'
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: ä»£ç æ‰§è¡Œ 4
        type: code
        variables:
        - value_selector:
          - '1759462105654'
          - base_dir
          value_type: string
          variable: base_dir
        - value_selector:
          - '1761146628628'
          - item
          value_type: string
          variable: text
      height: 53
      id: '1761146637925'
      parentId: '1761146628628'
      position:
        x: 129
        y: 68
      positionAbsolute:
        x: 1897.6844988249977
        y: 374.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1761146628628'
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: deepseek-reasoner
          provider: langgenius/deepseek/deepseek
        prompt_template:
        - id: b3cd657f-e91c-4548-89aa-b17806231ef3
          role: system
          text: "# è§’è‰²\n\nä½ æ˜¯ä¸€ä¸ªæ±½è½¦æ£€æµ‹é¢†åŸŸçš„æ³•è§„/æ ‡å‡†æ¡æ¬¾åŒ¹é…ä¸“å®¶ï¼Œä»»åŠ¡æ˜¯åœ¨`json`æ•°æ®ä¸­ï¼Œå¯¹ç°æœ‰çš„é€‰æ‹©ç»“æœè¿›è¡ŒäºŒæ¬¡ç­›é€‰ï¼Œåˆ¤æ–­å½“å‰é€‰æ‹©ç« èŠ‚æ˜¯å¦åŒ¹é…ï¼Œç¡®ä¿å®ƒä»¬è°ˆè®ºåŒä¸€ä¸»é¢˜æˆ–æ¶‰åŠé«˜åº¦ç›¸ä¼¼çš„å†…å®¹ï¼Œä¾¿äºåç»­è¿›è¡Œå·®å¼‚åŒ–åˆ†æã€‚\n\
            # è¾“å…¥æ ¼å¼\nä½ å°†æ”¶åˆ°ä¸€ä¸ª JSON å­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«è‹¥å¹²å…ƒç´ ï¼Œå…ƒç´ ç»“æ„å¦‚ä¸‹ï¼š\n\n```\n[\n  \"file\": \"string\"\
            ,\n  \"section\": \"string\",\n  \"chapter_id\": \"string\",\n  \"choices\"\
            :[] // åˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰åŒ¹é…çš„å€™é€‰ç« èŠ‚è·¯å¾„ï¼Œå¦‚ \"regulation\",\"MAIN\",\"3.1\"],\n  \"chapter_context\"\
            :[] // åˆ—è¡¨ï¼ŒåŒ…å«äº†å½“å‰ç« èŠ‚çš„ä¸Šä¸‹æ–‡å†…å®¹,\n  \"choice_context\":[] // åˆ—è¡¨ï¼Œåˆ†åˆ«å¯¹åº”äº†æ¯ä¸ªchoiceç« èŠ‚çš„ä¸Šä¸‹æ–‡å†…å®¹\n\
            ]\n```\n\n# è¾“å‡ºæ ¼å¼\n\nè¾“å‡ºå¿…é¡»æ˜¯çº¯å‡€ã€å®Œæ•´çš„`json`å¯¹è±¡ï¼Œç¡®ä¿å¯ä»¥è¢«`json.loads()`ç›´æ¥è§£æï¼Œç»“æ„å¦‚ä¸‹ï¼š\n\
            \n```\n[\n  \"file\": \"string\",\n  \"section\": \"string\",\n  \"chapter_id\"\
            : \"string\",\n  \"choices\":[] // åˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰åŒ¹é…çš„å€™é€‰ç« èŠ‚è·¯å¾„ï¼Œå¦‚[\"regulation\",\"\
            MAIN\",\"3.1\"]\n]\n```\n\n# æŒ‡å¯¼åŸåˆ™\n\n- ä¸è¿›è¡Œæ·»åŠ ï¼šåªè¿›è¡Œè¿‡æ»¤ï¼Œæ— åŒ¹é…é¡¹çš„ç« èŠ‚ç»å¯¹ä¸æ·»åŠ åŒ¹é…é¡¹ã€‚\n\n\
            - åŸå§‹æ–‡æœ¬åˆ†æï¼šè¯·æ ¹æ®å·²é€‰æ‹©åŒ¹é…é¡¹ï¼Œåˆ©ç”¨ç»™å‡ºçš„ä¸Šä¸‹æ–‡è¿›è¡Œåˆ†æï¼Œè¯·å¦¥å–„åˆ©ç”¨æä¾›çš„ä¸¤ç§`context`å­—æ®µï¼Œå§‹ç»ˆä¿æŒè¯­ä¹‰ç†è§£ä¸ºä¸»ã€‚\n\n\
            - ä¸Šä¸‹æ–‡è¯´æ˜ï¼šæä¾›çš„ä¸¤é’Ÿ`context`å­—æ®µä¸­ï¼ŒåŒ…å«äº†å…¶æ‰€åœ¨å¤§ç« èŠ‚çš„ä¸€çº§ç›®å½•åˆ°å…¶å¯¹åº”ç« èŠ‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚\n\n- å¤§èƒ†åœ°ä¸è¿›è¡Œé€‰æ‹©ï¼šä¸æ˜¯æ¯ä¸ªé¡¹éƒ½å¿…é¡»è¾“å‡ºåŒ¹é…å†…å®¹ï¼Œåœ¨å……åˆ†ç†è§£è¯­ä¹‰ä¹‹åè®¤ä¸ºä¸åŒ¹é…çš„é¡¹åº”è¯¥å¤§èƒ†åœ°ä¸è¿›è¡Œé€‰æ‹©ã€‚"
        - id: 8b5df4ad-dc1a-4869-bd21-15361a395cd7
          role: user
          text: '{{#1761146637925.result#}}'
        selected: true
        title: LLM 2
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1761146640444'
      parentId: '1761146628628'
      position:
        x: 431
        y: 66
      positionAbsolute:
        x: 2199.6844988249977
        y: 372.5
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
      zIndex: 1002
    - data:
        code: "import json\nimport ast\nimport re\nfrom typing import Dict, List,\
          \ Any\n\ndef parse_input(src: str) -> List[Dict[str, Any]]:\n    \"\"\"\
          é¢„å¤„ç†å¹¶è§£æè¾“å…¥å­—ç¬¦ä¸²ä¸ºåˆ—è¡¨å­—å…¸ç»“æ„\"\"\"\n    try:\n        # 1. æŒ‰ </think> åˆ‡åˆ†å¹¶å–ååŠæ®µ\n  \
          \      src = src.rsplit('</think>', 1)[-1].strip()\n\n        # 2. å…ˆå¹²æ‰ deepseek\
          \ V3 å¯èƒ½æ’å…¥çš„â€œæé€Ÿâ€æˆ–å•ç‹¬çš„â€œæâ€\n        src = re.sub(r'æé€Ÿ\\s*', '', src)   # å»æ‰â€œæé€Ÿâ€åŠå…¶åå¯èƒ½çš„å¤šä½™ç©ºç™½\n\
          \        src = re.sub(r'(?<!\\w)æ(?!\\w)', '', src)  # å»æ‰å­¤ç«‹å‡ºç°çš„â€œæâ€\n\n  \
          \      # 3. å°è¯•å¤šç§è§£æè·¯å¾„\n        try:\n            data = json.loads(src)\n\
          \        except json.JSONDecodeError:\n            try:\n              \
          \  if src.startswith('\\ufeff'):\n                    src = src[1:]\n  \
          \              data = ast.literal_eval(src)\n            except (SyntaxError,\
          \ ValueError):\n                try:\n                    processed = src.replace('\\\
          \\\"', '\"').replace('\\\\n', '\\n')\n                    data = json.loads(processed)\n\
          \                except Exception as e:\n                    raise ValueError(f\"\
          æ— æ³•è§£æï¼š{str(e)}\")\n\n        # 4. ä¿è¯è¿”å› list\n        if isinstance(data,\
          \ dict):\n            return [data]\n        elif isinstance(data, list):\n\
          \            return data\n        else:\n            return []\n    except\
          \ Exception as e:\n        raise ValueError(f\"é¢„å¤„ç†å¤±è´¥: {str(e)}\")\n\n\n\
          def main(arg1: str) -> dict:\n    data = parse_input(arg1)\n    return {\n\
          \        \"result\": json.dumps(data, ensure_ascii=False),\n    }"
        code_language: python3
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1761146628628'
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: ä»£ç æ‰§è¡Œ 5
        type: code
        variables:
        - value_selector:
          - '1761146640444'
          - text
          value_type: string
          variable: arg1
      height: 53
      id: '1761146644616'
      parentId: '1761146628628'
      position:
        x: 736
        y: 68
      positionAbsolute:
        x: 2504.6844988249977
        y: 374.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
      zIndex: 1002
    - data:
        code: "\nimport json\nimport os\ndef main(arg1: list[str], base_dir: str)\
          \ -> dict:\n    result = []\n    for temp in arg1:\n        data = json.loads(temp)\n\
          \        result.extend(data)\n    path = f\"/tmp/mydata/{base_dir}/selected_results.json\"\
          \n    os.makedirs(os.path.dirname(path), exist_ok=True)\n    with open(path,\
          \ \"w\", encoding=\"utf-8\") as f:\n        json.dump(result, f, ensure_ascii=False,\
          \ indent=2)\n    return {\n        \"result\": path,\n    }"
        code_language: python3
        desc: ''
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: ä»£ç æ‰§è¡Œ 6
        type: code
        variables:
        - value_selector:
          - '1761146628628'
          - output
          value_type: array[string]
          variable: arg1
        - value_selector:
          - '1759462105654'
          - base_dir
          value_type: string
          variable: base_dir
      height: 53
      id: '1761146651735'
      position:
        x: 2823.6844988249977
        y: 306.5
      positionAbsolute:
        x: 2823.6844988249977
        y: 306.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '{{#1761146628628.output#}}'
        desc: ''
        selected: false
        title: ç›´æ¥å›å¤
        type: answer
        variables: []
      height: 104
      id: '1761146711281'
      position:
        x: 3129.6844988249977
        y: 306.5
      positionAbsolute:
        x: 3129.6844988249977
        y: 306.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: -1804.1844988249977
      y: 152
      zoom: 1
